<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>AUDIOrecord</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        *{margin:0;padding:0;box-sizing:border-box;}
        body{
            font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
            background:#111;
            color:#fff;
            min-height:100vh;
        }
        .topbar{
            height:56px;
            background:#3b3b3b;
            display:flex;
            align-items:center;
            padding:0 16px;
        }
        .logo-icon{
            width:28px;height:28px;border-radius:6px;
            background:linear-gradient(135deg,#ff005c,#ff3366);
            margin-right:10px;position:relative;
        }
        .logo-icon::before,
        .logo-icon::after{
            content:"";position:absolute;width:3px;border-radius:2px;background:#fff;
        }
        .logo-icon::before{
            height:14px;left:9px;top:7px;
            box-shadow:5px 2px 0 #fff,10px -2px 0 #fff;
        }
        .app-title{font-size:18px;font-weight:700;letter-spacing:1px;}
        .app-title span:first-child{color:#ff2b63;}

        .screen{
            height:calc(100vh - 56px);
            display:flex;
            flex-direction:column;
            align-items:center;
            justify-content:center;
            position:relative;
        }

        .wave-container{
            position:absolute;
            left:0;right:0;
            top:26%;
            margin:auto;
            width:80%;
            height:80px;
            display:flex;
            align-items:flex-end;
            justify-content:space-between;
        }
        .bar{
            width:4px;
            border-radius:2px;
            background:#ff2b63;
            transform-origin:bottom;
            transform:scaleY(0.2);
            transition:transform 0.08s linear;
        }

        .record-btn-wrapper{
            position:absolute;
            bottom:120px;
            left:0;right:0;
            display:flex;
            justify-content:center;
        }
        .record-btn{
            width:80px;height:80px;border-radius:50%;
            border:none;cursor:pointer;
            background:#ff2b63;
            display:flex;align-items:center;justify-content:center;
            box-shadow:0 10px 30px rgba(255,43,99,.6);
            transition:transform .15s,box-shadow .15s,background .15s;
        }
        .record-btn i{font-size:32px;color:#fff;}
        .record-btn:active{
            transform:translateY(2px) scale(.96);
            box-shadow:0 4px 16px rgba(255,43,99,.45);
        }
        .screen.recording .record-btn{
            background:#16a34a;
            box-shadow:0 0 25px rgba(22,163,74,.8);
        }

        /* блок с доп. кнопками */
        .controls{
            position:absolute;
            bottom:40px;
            left:0;right:0;
            display:flex;
            justify-content:center;
            gap:12px;
        }
        .ctrl-btn{
            min-width:70px;
            padding:6px 10px;
            border-radius:20px;
            border:1px solid #444;
            background:#222;
            color:#eee;
            font-size:12px;
            cursor:pointer;
            display:flex;
            align-items:center;
            justify-content:center;
            gap:4px;
            transition:background .15s,border-color .15s,transform .1s;
        }
        .ctrl-btn:active{
            transform:translateY(1px);
        }
        .ctrl-btn--danger{
            border-color:#b91c1c;
            color:#fecaca;
        }
        .ctrl-btn--danger:hover{background:#7f1d1d;}
        .ctrl-btn:hover{background:#333;}

        .status-text{
            position:absolute;
            bottom:88px;
            left:0;right:0;
            text-align:center;
            font-size:13px;
            color:#bbb;
        }
        .screen.recording .status-text{color:#16a34a;}
    </style>
</head>
<body>
<div class="topbar">
    <div class="logo-icon"></div>
    <div class="app-title"><span>AUDIO</span><span>record</span></div>
</div>

<div class="screen" id="screen">
    <!-- звуковая волна -->
    <div class="wave-container" id="wave">
        <!-- 16 полос -->
        <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
        <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
        <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
        <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
    </div>

    <!-- кнопка записи -->
    <div class="record-btn-wrapper">
        <button class="record-btn" id="recordBtn">
            <i class="fas fa-microphone"></i>
        </button>
    </div>

    <div class="status-text" id="statusText">Нажмите, чтобы начать запись</div>

    <!-- новые кнопки управления -->
    <div class="controls">
        <button class="ctrl-btn" id="pauseBtn">
            <i class="fas fa-pause"></i><span>Пауза</span>
        </button>
        <button class="ctrl-btn" id="resumeBtn">
            <i class="fas fa-play"></i><span>Продолжить</span>
        </button>
        <button class="ctrl-btn ctrl-btn--danger" id="stopBtn">
            <i class="fas fa-ban"></i><span>Прервать</span>
        </button>
    </div>
</div>

<script>
    const screen = document.getElementById('screen');
    const recordBtn = document.getElementById('recordBtn');
    const statusText = document.getElementById('statusText');
    const bars = document.querySelectorAll('.bar');

    const pauseBtn = document.getElementById('pauseBtn');
    const resumeBtn = document.getElementById('resumeBtn');
    const stopBtn = document.getElementById('stopBtn');

    let recording = false;
    let audioContext, analyser, source, dataArray, rafId, stream;

    async function startAudio() {
        stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        analyser = audioContext.createAnalyser();
        analyser.fftSize = 64;
        const bufferLength = analyser.frequencyBinCount;
        dataArray = new Uint8Array(bufferLength);

        source = audioContext.createMediaStreamSource(stream);
        source.connect(analyser);

        visualize();
    }

    function visualize() {
        rafId = requestAnimationFrame(visualize);
        if (!analyser) return;
        analyser.getByteFrequencyData(dataArray);
        const step = Math.floor(dataArray.length / bars.length) || 1;

        bars.forEach((bar, i) => {
            const v = dataArray[i * step] / 255;
            const min = 0.2;
            const scale = min + v * 2.5;
            bar.style.transform = `scaleY(${scale})`;
        });
    }

    function resetWave() {
        bars.forEach(bar => bar.style.transform = 'scaleY(0.2)');
    }

    async function handleRecordClick() {
        if (!recording) {
            try {
                await startAudio();
                recording = true;
                screen.classList.add('recording');
                statusText.textContent = 'Запись... волна реагирует на звук';
                recordBtn.innerHTML = '<i class="fas fa-stop"></i>';
            } catch (e) {
                statusText.textContent = 'Нет доступа к микрофону';
            }
        } else {
            // по нажатию на большой круг – просто остановка записи
            fullStop();
        }
    }

    function fullStop() {
        recording = false;
        screen.classList.remove('recording');
        statusText.textContent = 'Запись прервана';
        recordBtn.innerHTML = '<i class="fas fa-microphone"></i>';

        if (rafId) cancelAnimationFrame(rafId);
        resetWave();

        if (audioContext) {
            audioContext.close();
            audioContext = null;
        }
        if (stream) {
            stream.getTracks().forEach(t => t.stop());
            stream = null;
        }
        analyser = null;
        source = null;
    }

    recordBtn.addEventListener('click', handleRecordClick);

    // Пауза: заморозить аудио и анимацию
    pauseBtn.addEventListener('click', async () => {
        if (!audioContext || audioContext.state !== 'running') return;
        await audioContext.suspend();
        statusText.textContent = 'Пауза записи';
    });

    // Продолжить
    resumeBtn.addEventListener('click', async () => {
        if (!audioContext || audioContext.state !== 'suspended') return;
        await audioContext.resume();
        statusText.textContent = 'Запись продолжается';
    });

    // Прервать полностью
    stopBtn.addEventListener('click', () => {
        if (!recording && !audioContext) return;
        fullStop();
    });
</script>
</body>
</html>
